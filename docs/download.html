<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Download CSV</title>
</head>
<body>
<script>
(function(){
  const params=new URLSearchParams(window.location.search);
  const type=params.get('type');
  const key=type==='calc' ? 'calcCsv' : 'occCsv';
  const csv=localStorage.getItem(key);
  if(!csv){ window.close(); return; }
  const blob=new Blob([csv],{type:'text/csv'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download=type==='calc' ? 'space-calculator.csv' : 'occupancy-costs.csv';
  document.body.appendChild(link);
  link.click();
  setTimeout(()=>{
    URL.revokeObjectURL(link.href);
    document.body.removeChild(link);
    localStorage.removeItem(key);
    window.close();
  },100);
})();
</script>
</body>
</html>
